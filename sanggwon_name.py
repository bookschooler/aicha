import pandas as pd
import re # ì •ê·œí‘œí˜„ì‹ ë¼ì´ë¸ŒëŸ¬ë¦¬ (íŒ¨í„´ìœ¼ë¡œ ë¬¸ì ì°¾ê¸°)

# 1. íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
filename = 'y_final.csv'
print(f"ğŸ“‚ '{filename}' ë¡œë”© ì¤‘...")
try:
    df = pd.read_csv(filename, encoding='utf-8')
except:
    df = pd.read_csv(filename, encoding='cp949')

trade_area_list = df['ìƒê¶Œ_ì½”ë“œ_ëª…'].unique()
print(f"ğŸ“Š ì´ {len(trade_area_list)}ê°œì˜ ìƒê¶Œëª…ì„ ë‹¤ë“¬ìŠµë‹ˆë‹¤.")

# ---------------------------------------------------------
# 2. [ê°•ë ¥] í‚¤ì›Œë“œ ì²­ì†Œ í•¨ìˆ˜ v2
# ---------------------------------------------------------
def clean_keyword_v2(raw_name):
    if pd.isna(raw_name): return ""
    
    name = str(raw_name)
    
    # [ì²­ì†Œ 1] ê´„í˜¸ì™€ ê·¸ ì•ˆì˜ ë‚´ìš© ì œê±°
    # ì˜ˆ: "êµëŒ€ì—­(ë²•ì›.ê²€ì°°ì²­)" -> "êµëŒ€ì—­"
    name = re.sub(r'\(.*?\)', '', name)
    
    # [ì²­ì†Œ 2] 'ìˆ«ì+ë²ˆ' ë˜ëŠ” 'ìˆ«ì+ë²ˆì¶œêµ¬' íŒ¨í„´ ì œê±°
    # ì˜ˆ: "ìƒë„ì—­ 2ë²ˆ" -> "ìƒë„ì—­" / "ì˜ë“±í¬êµ¬ì²­ì—­ 6ë²ˆ" -> "ì˜ë“±í¬êµ¬ì²­ì—­"
    # (\s+ : ê³µë°±ì´ ìˆê³  / \d+ : ìˆ«ìê°€ ë‚˜ì˜¤ê³  / ë²ˆ : 'ë²ˆ'ì´ ë‚˜ì˜¤ëŠ” ê²ƒ)
    name = re.sub(r'\s+\d+ë²ˆ.*', '', name)
    
    # [ì²­ì†Œ 3] í˜¹ì‹œ ëª¨ë¥¼ ì–¸ë”ë°”(_) ë’¤ ì œê±°
    if "_" in name:
        name = name.split('_')[0]

    # [ì²­ì†Œ 4] 'ìƒì ê°€' ê°™ì€ ë„ˆë¬´ ê¸´ ê¼¬ë¦¬í‘œ ì œê±° (ì„ íƒ ì‚¬í•­)
    # "ì¥ì‹ êµ¬ íŠ¹í™”ê±°ë¦¬ ìƒì ê°€" -> "ì¥ì‹ êµ¬ íŠ¹í™”ê±°ë¦¬" (ê²€ìƒ‰ì´ ë” ì˜ ë¨)
    name = name.replace('ìƒì ê°€', '')
    
    # ì•ë’¤ ê³µë°± ì œê±°
    name = name.strip()
    
    return name + " ì¹´í˜"

# ---------------------------------------------------------
# 3. ë³€í™˜ ë° í™•ì¸
# ---------------------------------------------------------
print("\nâœ¨ ë³€í™˜ ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸° (Before & After)")
print("-" * 60)

final_keywords = []

# ì˜í”¼ê°€ ë§í•´ì¤€ ì˜ˆì‹œë“¤ì´ ì˜ ë°”ë€ŒëŠ”ì§€ í™•ì¸í•´ë³´ì!
test_cases = [
    "ìƒë„ì—­ 2ë²ˆ", 
    "êµëŒ€ì—­(ë²•ì›.ê²€ì°°ì²­)", 
    "ì˜ë“±í¬êµ¬ì²­ì—­ 6ë²ˆ", 
    "ì¥ì‹ êµ¬ íŠ¹í™”ê±°ë¦¬ ìƒì ê°€",
    "ë™ëŒ€ë¶€ì—¬ê³ "
]
# ì‹¤ì œ ë°ì´í„° + í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì„ì–´ì„œ í™•ì¸
check_list = list(test_cases) + list(trade_area_list[:5])

for raw in trade_area_list:
    search_term = clean_keyword_v2(raw)
    final_keywords.append({'ì›ë³¸_ìƒê¶Œëª…': raw, 'ê²€ìƒ‰ì–´': search_term})

# ì˜í”¼ê°€ ì§€ì í–ˆë˜ ì• ë“¤ ìœ„ì£¼ë¡œ ì¶œë ¥í•´ë³¼ê²Œ!
for raw in test_cases:
    print(f"âŒ {raw:<20} â¡ â­• {clean_keyword_v2(raw)}")

# ---------------------------------------------------------
# 4. ì €ì¥
# ---------------------------------------------------------
df_result = pd.DataFrame(final_keywords)
df_result.to_csv('search_list.csv', index=False, encoding='utf-8-sig')
print("-" * 60)
print("ğŸ’¾ 'search_list.csv' ì €ì¥ ì™„ë£Œ! ì´ì œ ê¹”ë”í•  ê±°ì•¼! ğŸ˜")